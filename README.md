# TODO API + WebSocket + Фоновая задача

## Описание проекта
Проект реализует **серверный backend на FastAPI** с поддержкой:

- REST API для управления задачами (TODO-list)
- WebSocket-канала для уведомлений в реальном времени
- Фоновой задачи, которая собирает данные с внешнего сайта (Citilink)
- Асинхронного взаимодействия с базой данных через SQLModel
- NATS как брокер сообщений для рассылки событий изменения задач

Проект предназначен для обучения работе с FastAPI, асинхронной обработкой данных, WebSocket и брокерами сообщений.

---

## Функционал

### REST API

| Метод | URL | Описание |
|-------|-----|----------|
| GET | `/tasks` | Получить список всех задач |
| GET | `/tasks/{id}` | Получить задачу по ID |
| POST | `/tasks` | Создать новую задачу |
| PUT | `/tasks/{id}` | Полное обновление задачи |
| PATCH | `/tasks/{id}` | Частичное обновление задачи |
| DELETE | `/tasks/{id}` | Удалить задачу |
| POST | `/task-generator/run` | Принудительно запустить фоновую задачу (парсер) |

---

### WebSocket

- **URL:** `/ws/tasks`
- Получение уведомлений о событиях `tasks.created`, `tasks.updated`, `tasks.deleted`
- Все клиенты получают уведомления в реальном времени

---

### Фоновая задача

- Парсер Citilink (`/parser`) собирает список товаров из категории смартфонов
- Фоновая задача запускается автоматически через HTTP-запрос или эндпоинт `/task-generator/run`
- Результаты работы выводятся в консоль

---

### NATS (брокер сообщений)

- Подключение к локальному NATS серверу (`nats://127.0.0.1:4222`)
- Подписка на топики `tasks.*` для публикации событий
- Любые события задач транслируются подключенным WebSocket-клиентам

---

### Запуск

uvicorn main:app

1) ./nats-server - запуск сервера
2) ./nats sub "tasks.*" - подписка на события

---

### Тестирование

1. REST API через FastAPI Swagger UI http://127.0.0.1:8000/docs

2. WebSocket через клиент на URL ws://0.0.0.0:8000/ws или ws://127.0.0.1:8000/ws/tasks
